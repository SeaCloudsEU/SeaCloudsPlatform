name: SeaClouds Planner
services:
- type: brooklyn.entity.basic.VanillaSoftwareProcess
  name: Planner Rest Service
  brooklyn.config:
    planner.config.port: 1234
    planner.config.discoverer.url: undefined
    planner.config.optimizer.url: undefined
    planner.config.monitor_generator.url: undefined
    planner.config.sla_generator.url: undefined
    planner.config.service.url: https://oss.sonatype.org/service/local/artifact/maven/redirect?r=snapshots&g=eu.seaclouds-project&a=planner-service&v=LATEST&e=jar

  shell.env:
    PLANNER_PORT: $brooklyn:config("planner.config.port")
    DISCOVERER_URL: $brooklyn:config("planner.config.discoverer.url")
    OPTIMIZER_URL: $brooklyn:config("planner.config.optimizer.url")
    MONITOR_GENERATOR_URL: $brooklyn:config("planner.config.monitor_generator.url")
    SLA_GENERATOR_URL: $brooklyn:config("planner.config.sla_generator.url")
    PLANNER_SERVICE_URL: $brooklyn:config("planner.config.service.url")

  launch.command: |
                sudo apt-get update
                sudo DEBIAN_FRONTEND=noninteractive apt-get install -y --allow-unauthenticated tzdata openjdk-7-jdk wget
                tee ./conf.yml  <<EOF
                server:
                  type: simple
                  applicationContextPath: /planner
                  adminContextPath: /admin
                  connector:
                   type: http
                   port: ${PLANNER_PORT}
                discovererURL: ${DISCOVERER_URL}
                optimizerURL: ${OPTIMIZER_URL}
                monitorGeneratorURL: ${MONITOR_GENERATOR_URL}
                slaGeneratorURL: ${SLA_GENERATOR_URL}
                EOF
                wget -O planner-service.jar ${PLANNER_SERVICE_URL}
                nohup java -jar planner-service.jar server conf.yml > console.out 2>&1 &
                echo $! > $PID_FILE

